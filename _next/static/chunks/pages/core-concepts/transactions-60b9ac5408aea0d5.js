(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[862],{6276:function(s,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/core-concepts/transactions",function(){return r(7509)}])},7509:function(s,e,r){"use strict";r.r(e),r.d(e,{__toc:function(){return c}});var l=r(5893),o=r(2673),n=r(6513),i=r(9004);r(4759);var t=r(2643);let c=[{depth:2,value:"The Executor Interface",id:"the-executor-interface"},{depth:2,value:"Basic Transaction Pattern",id:"basic-transaction-pattern"},{depth:2,value:"Repository Pattern",id:"repository-pattern"},{depth:3,value:"Usage Without Transaction",id:"usage-without-transaction"},{depth:3,value:"Usage With Transaction",id:"usage-with-transaction"},{depth:2,value:"Complete Example",id:"complete-example"},{depth:2,value:"Error Handling",id:"error-handling"}];function a(s){let e=Object.assign({h1:"h1",p:"p",code:"code",h2:"h2",pre:"pre",span:"span",h3:"h3",ul:"ul",li:"li"},(0,t.a)(),s.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{children:"Transactions"}),"\n",(0,l.jsxs)(e.p,{children:["go-lightning works seamlessly with database transactions through the ",(0,l.jsx)(e.code,{children:"Executor"})," interface."]}),"\n",(0,l.jsx)(e.h2,{id:"the-executor-interface",children:"The Executor Interface"}),"\n",(0,l.jsxs)(e.p,{children:["All go-lightning functions accept an ",(0,l.jsx)(e.code,{children:"Executor"}),":"]}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Executor"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"interface"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Exec"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(query "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"string"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", args "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"..."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"any) (sql.Result, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Query"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(query "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"string"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", args "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"..."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"any) ("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.Rows, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"QueryRow"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(query "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"string"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", args "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"..."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"any) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.Row"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsxs)(e.p,{children:["Both ",(0,l.jsx)(e.code,{children:"*sql.DB"})," and ",(0,l.jsx)(e.code,{children:"*sql.Tx"})," implement this interface, so you can use the same code with or without transactions."]}),"\n",(0,l.jsx)(e.h2,{id:"basic-transaction-pattern",children:"Basic Transaction Pattern"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"CreateUserWithProfile"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(db "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.DB, user "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"User, profile "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"Profile) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// No-op if committed"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Insert user"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    userId, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lit."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Insert"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, user)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Insert profile with user ID"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    profile.UserId "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" userId"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    _, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lit."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Insert"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, profile)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsx)(e.h2,{id:"repository-pattern",children:"Repository Pattern"}),"\n",(0,l.jsxs)(e.p,{children:["A common pattern is to accept an ",(0,l.jsx)(e.code,{children:"Executor"})," in your repository methods:"]}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"UserRepository"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"struct"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"{}"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (r "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"UserRepository) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Create"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ex lit.Executor, user "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"User) ("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"int"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lit."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Insert"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ex, user)"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (r "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"UserRepository) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"FindById"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ex lit.Executor, id "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"int"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:") ("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"User, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lit.SelectSingle[User](ex,"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SELECT id, first_name, last_name, email FROM users WHERE id = $1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", id)"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (r "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"UserRepository) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Update"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ex lit.Executor, user "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"User) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lit."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Update"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ex, user, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"id = $1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", user.Id)"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (r "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"UserRepository) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Delete"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ex lit.Executor, id "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"int"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lit."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Delete"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ex, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"DELETE FROM users WHERE id = $1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", id)"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsx)(e.h3,{id:"usage-without-transaction",children:"Usage Without Transaction"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"repo "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"UserRepository{}"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" repo."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"FindById"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(db, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"123"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})}),"\n",(0,l.jsx)(e.h3,{id:"usage-with-transaction",children:"Usage With Transaction"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"repo "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"UserRepository{}"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" repo."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"FindById"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"123"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user.Email "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"new@example.com"'})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" repo."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Update"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, user); err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]})]})}),"\n",(0,l.jsx)(e.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"OrderService"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"struct"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    db        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.DB"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    users     "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"UserRepository"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    orders    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"OrderRepository"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    inventory "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"InventoryRepository"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (s "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"OrderService) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"PlaceOrder"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(userId "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"int"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", items []OrderItem) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" s.db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Verify user exists"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    user, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" s.users."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"FindById"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, userId)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" user "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" errors."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"New"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"user not found"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Create order"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    order "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"Order{UserId: userId, Status: "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"pending"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    orderId, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" s.orders."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Create"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, order)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Add items and update inventory"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" _, item "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"range"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" items {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        item.OrderId "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" orderId"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" _, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" s.orders."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"AddItem"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"item); err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" s.inventory."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Decrement"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, item.ProductId, item.Quantity); err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsx)(e.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,l.jsxs)(e.p,{children:["The deferred ",(0,l.jsx)(e.code,{children:"Rollback()"})," pattern is safe because:"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["If ",(0,l.jsx)(e.code,{children:"Commit()"})," succeeds, ",(0,l.jsx)(e.code,{children:"Rollback()"})," is a no-op"]}),"\n",(0,l.jsxs)(e.li,{children:["If any error occurs before ",(0,l.jsx)(e.code,{children:"Commit()"}),", the transaction is rolled back"]}),"\n",(0,l.jsxs)(e.li,{children:["If ",(0,l.jsx)(e.code,{children:"Commit()"})," fails, the transaction is also rolled back"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Safe: no-op after successful commit"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ... operations ..."})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(); err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Rollback already called by defer"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" fmt."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Errorf"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"failed to commit: '}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"%w"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", err)"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"})]})]})})]})}let h={MDXContent:function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,t.a)(),s.components);return e?(0,l.jsx)(e,{...s,children:(0,l.jsx)(a,{...s})}):a(s)},pageOpts:{filePath:"pages/core-concepts/transactions.mdx",route:"/core-concepts/transactions",timestamp:1769053695e3,pageMap:[{kind:"Meta",data:{index:"Home","getting-started":"Getting Started","core-concepts":"Core Concepts",comparison:"Comparison",guides:"Guides","api-reference":"API Reference",examples:"Examples"}},{kind:"Folder",name:"api-reference",route:"/api-reference",children:[{kind:"Meta",data:{functions:"Functions"}},{kind:"MdxPage",name:"functions",route:"/api-reference/functions"}]},{kind:"MdxPage",name:"comparison",route:"/comparison"},{kind:"Folder",name:"core-concepts",route:"/core-concepts",children:[{kind:"Meta",data:{registration:"Registration",queries:"Queries",mutations:"Mutations",transactions:"Transactions"}},{kind:"MdxPage",name:"mutations",route:"/core-concepts/mutations"},{kind:"MdxPage",name:"queries",route:"/core-concepts/queries"},{kind:"MdxPage",name:"registration",route:"/core-concepts/registration"},{kind:"MdxPage",name:"transactions",route:"/core-concepts/transactions"}]},{kind:"Folder",name:"examples",route:"/examples",children:[{kind:"Meta",data:{"crud-repository":"CRUD Repository"}},{kind:"MdxPage",name:"crud-repository",route:"/examples/crud-repository"}]},{kind:"Folder",name:"getting-started",route:"/getting-started",children:[{kind:"Meta",data:{installation:"Installation","quick-start":"Quick Start"}},{kind:"MdxPage",name:"installation",route:"/getting-started/installation"},{kind:"MdxPage",name:"quick-start",route:"/getting-started/quick-start"}]},{kind:"Folder",name:"guides",route:"/guides",children:[{kind:"Meta",data:{"naming-strategies":"Table & Column Naming","uuid-support":"UUID Support",projections:"Projections & DTOs"}},{kind:"MdxPage",name:"naming-strategies",route:"/guides/naming-strategies"},{kind:"MdxPage",name:"projections",route:"/guides/projections"},{kind:"MdxPage",name:"uuid-support",route:"/guides/uuid-support"}]},{kind:"MdxPage",name:"index",route:"/"}],flexsearch:{codeblocks:!0},title:"Transactions",headings:c},pageNextRoute:"/core-concepts/transactions",nextraLayout:n.ZP,themeConfig:i.Z};e.default=(0,o.j)(h)},9004:function(s,e,r){"use strict";var l=r(5893);e.Z={logo:(0,l.jsx)("span",{style:{fontWeight:700,fontSize:"1.2rem"},children:" go-lightning"}),project:{link:"https://github.com/tracewayapp/go-lightning"},docsRepositoryBase:"https://github.com/tracewayapp/go-lightning/tree/main/docs",useNextSeoProps:()=>({titleTemplate:"%s  go-lightning"}),head:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,l.jsx)("meta",{property:"og:title",content:"go-lightning"}),(0,l.jsx)("meta",{property:"og:description",content:"Lightweight Go library for simplified database operations"})]}),primaryHue:205,darkMode:!0,nextThemes:{defaultTheme:"dark"},sidebar:{defaultMenuCollapseLevel:1,toggleButton:!0},toc:{backToTop:!0},editLink:{text:"Edit this page on GitHub "},feedback:{content:"Question? Give us feedback ",labels:"feedback"},footer:{text:(0,l.jsxs)("span",{children:["MIT ",new Date().getFullYear()," \xa9"," ",(0,l.jsx)("a",{href:"https://github.com/tracewayapp",target:"_blank",children:"Traceway"})]})}}},5789:function(){}},function(s){s.O(0,[73,888,774,179],function(){return s(s.s=6276)}),_N_E=s.O()}]);