(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[417],{4392:function(s,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/guides/transactions",function(){return n(3269)}])},3269:function(s,e,n){"use strict";n.r(e),n.d(e,{__toc:function(){return a}});var l=n(5893),r=n(2673),o=n(6513),i=n(9004);n(4759);var t=n(2643);let a=[{depth:2,value:"Why Transactions?",id:"why-transactions"},{depth:2,value:"Basic Transaction Pattern",id:"basic-transaction-pattern"},{depth:2,value:"The Deferred Rollback Pattern",id:"the-deferred-rollback-pattern"},{depth:3,value:"Why defer tx.Rollback()?",id:"why-defer-txrollback"},{depth:2,value:"Transaction Isolation Levels",id:"transaction-isolation-levels"},{depth:3,value:"Available Levels",id:"available-levels"},{depth:3,value:"Database Defaults",id:"database-defaults"},{depth:3,value:"When to Use Each Level",id:"when-to-use-each-level"},{depth:2,value:"Read-Only Transactions",id:"read-only-transactions"},{depth:2,value:"Context and Timeouts",id:"context-and-timeouts"},{depth:3,value:"With Timeout",id:"with-timeout"},{depth:3,value:"With Cancellation",id:"with-cancellation"},{depth:2,value:"Multiple Operations in One Transaction",id:"multiple-operations-in-one-transaction"},{depth:3,value:"Example: Transfer Money",id:"example-transfer-money"},{depth:3,value:"Example: Create User with Profile",id:"example-create-user-with-profile"},{depth:2,value:"Nested Transactions (Savepoints)",id:"nested-transactions-savepoints"},{depth:3,value:"PostgreSQL Savepoints",id:"postgresql-savepoints"},{depth:3,value:"MySQL Savepoints",id:"mysql-savepoints"},{depth:2,value:"Connection Pooling",id:"connection-pooling"},{depth:3,value:"Pool Exhaustion",id:"pool-exhaustion"},{depth:2,value:"Error Handling Patterns",id:"error-handling-patterns"},{depth:3,value:"Basic Error Handling",id:"basic-error-handling"},{depth:3,value:"With Logging",id:"with-logging"},{depth:3,value:"With Custom Errors",id:"with-custom-errors"},{depth:2,value:"Best Practices",id:"best-practices"},{depth:3,value:"1. Always Use defer tx.Rollback()",id:"1-always-use-defer-txrollback"},{depth:3,value:"2. Keep Transactions Short",id:"2-keep-transactions-short"},{depth:3,value:"3. Don't Perform I/O Inside Transactions",id:"3-dont-perform-io-inside-transactions"},{depth:3,value:"4. Use Appropriate Isolation Levels",id:"4-use-appropriate-isolation-levels"},{depth:3,value:"5. Add Timeouts",id:"5-add-timeouts"},{depth:2,value:"Troubleshooting",id:"troubleshooting"},{depth:3,value:'"sql: transaction has already been committed or rolled back"',id:"sql-transaction-has-already-been-committed-or-rolled-back"},{depth:3,value:'"pq: deadlock detected"',id:"pq-deadlock-detected"},{depth:3,value:'"too many connections"',id:"too-many-connections"},{depth:2,value:"Summary",id:"summary"},{depth:2,value:"Next Steps",id:"next-steps"}];function c(s){let e=Object.assign({h1:"h1",p:"p",h2:"h2",code:"code",ol:"ol",li:"li",strong:"strong",pre:"pre",span:"span",h3:"h3",ul:"ul",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",a:"a"},(0,t.a)(),s.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{children:"Transactions"}),"\n",(0,l.jsx)(e.p,{children:"A comprehensive guide to working with database transactions in go-lightning."}),"\n",(0,l.jsx)(e.h2,{id:"why-transactions",children:"Why Transactions?"}),"\n",(0,l.jsxs)(e.p,{children:["All go-lightning operations require a ",(0,l.jsx)(e.code,{children:"*sql.Tx"})," (transaction) parameter, not ",(0,l.jsx)(e.code,{children:"*sql.DB"}),". This design choice provides:"]}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Explicit control"})," - You decide when to commit or rollback"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Consistency"})," - Multiple operations execute as a single atomic unit"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Isolation"})," - Changes are isolated until committed"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Safety"})," - Automatic rollback on errors using ",(0,l.jsx)(e.code,{children:"defer"})]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"basic-transaction-pattern",children:"Basic Transaction Pattern"}),"\n",(0,l.jsx)(e.p,{children:"The recommended pattern for transactions:"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Begin transaction"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Rollback if not committed"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Perform database operations"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"id, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Automatic rollback via defer"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// More operations..."})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg.SelectGenericSingle[User](tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SELECT * FROM users WHERE id = $1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", id)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Commit transaction"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(); err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Success - changes are persisted"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"})]})]})}),"\n",(0,l.jsx)(e.h2,{id:"the-deferred-rollback-pattern",children:"The Deferred Rollback Pattern"}),"\n",(0,l.jsxs)(e.h3,{id:"why-defer-txrollback",children:["Why ",(0,l.jsx)(e.code,{children:"defer tx.Rollback()"}),"?"]}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsx)(e.code,{"data-language":"go","data-theme":"default",children:(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]})})}),"\n",(0,l.jsx)(e.p,{children:"This line ensures cleanup regardless of how the function exits:"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Safe behavior:"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["If ",(0,l.jsx)(e.code,{children:"Commit()"})," succeeds → ",(0,l.jsx)(e.code,{children:"Rollback()"})," is a ",(0,l.jsx)(e.strong,{children:"no-op"})," (does nothing)"]}),"\n",(0,l.jsxs)(e.li,{children:["If error occurs → ",(0,l.jsx)(e.code,{children:"Rollback()"})," ",(0,l.jsx)(e.strong,{children:"reverts changes"})]}),"\n",(0,l.jsxs)(e.li,{children:["If function panics → ",(0,l.jsx)(e.code,{children:"Rollback()"})," ",(0,l.jsx)(e.strong,{children:"still executes"})]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Without defer:"})}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ❌ Don't do this"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"id, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Must remember every time"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// More operations..."})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"UpdateGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, user, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"id = $1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", id)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Easy to forget!"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]})]})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"With defer:"})}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ✅ Always use defer"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// One line, always executes"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"id, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Rollback happens automatically"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ... more operations ..."})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// If reached, rollback is no-op"})]})]})}),"\n",(0,l.jsx)(e.h2,{id:"transaction-isolation-levels",children:"Transaction Isolation Levels"}),"\n",(0,l.jsx)(e.p,{children:"Control how transactions interact with each other:"}),"\n",(0,l.jsx)(e.h3,{id:"available-levels",children:"Available Levels"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"database/sql"'})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BeginTx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(context."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Background"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(), "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.TxOptions{"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    Isolation: sql.LevelRepeatableRead,"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"})"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]})]})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"Isolation levels"})," (from weakest to strongest):"]}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"Level"}),(0,l.jsx)(e.th,{children:"Description"}),(0,l.jsx)(e.th,{children:"Dirty Read"}),(0,l.jsx)(e.th,{children:"Non-Repeatable Read"}),(0,l.jsx)(e.th,{children:"Phantom Read"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"LevelDefault"})}),(0,l.jsx)(e.td,{children:"Database default"}),(0,l.jsx)(e.td,{children:"Depends"}),(0,l.jsx)(e.td,{children:"Depends"}),(0,l.jsx)(e.td,{children:"Depends"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"LevelReadUncommitted"})}),(0,l.jsx)(e.td,{children:"Can see uncommitted changes"}),(0,l.jsx)(e.td,{children:"✅"}),(0,l.jsx)(e.td,{children:"✅"}),(0,l.jsx)(e.td,{children:"✅"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"LevelReadCommitted"})}),(0,l.jsx)(e.td,{children:"See only committed changes"}),(0,l.jsx)(e.td,{children:"❌"}),(0,l.jsx)(e.td,{children:"✅"}),(0,l.jsx)(e.td,{children:"✅"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"LevelRepeatableRead"})}),(0,l.jsx)(e.td,{children:"Consistent reads within tx"}),(0,l.jsx)(e.td,{children:"❌"}),(0,l.jsx)(e.td,{children:"❌"}),(0,l.jsx)(e.td,{children:"✅"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"LevelSerializable"})}),(0,l.jsx)(e.td,{children:"Full isolation"}),(0,l.jsx)(e.td,{children:"❌"}),(0,l.jsx)(e.td,{children:"❌"}),(0,l.jsx)(e.td,{children:"❌"})]})]})]}),"\n",(0,l.jsx)(e.h3,{id:"database-defaults",children:"Database Defaults"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"PostgreSQL"}),": ",(0,l.jsx)(e.code,{children:"ReadCommitted"})]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"MySQL"}),": ",(0,l.jsx)(e.code,{children:"RepeatableRead"})]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"when-to-use-each-level",children:"When to Use Each Level"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"ReadUncommitted"})," (avoid):"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Rarely used"}),"\n",(0,l.jsx)(e.li,{children:"Can see dirty (uncommitted) data"}),"\n",(0,l.jsx)(e.li,{children:"Best for read-heavy reporting where exact accuracy isn't critical"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"ReadCommitted"})," (PostgreSQL default):"]}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BeginTx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ctx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.TxOptions{"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    Isolation: sql.LevelReadCommitted,"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"})"})})]})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Good for most applications"}),"\n",(0,l.jsx)(e.li,{children:"Prevents dirty reads"}),"\n",(0,l.jsx)(e.li,{children:"Allows concurrent updates"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"RepeatableRead"})," (MySQL default):"]}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BeginTx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ctx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.TxOptions{"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    Isolation: sql.LevelRepeatableRead,"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"})"})})]})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Stronger consistency"}),"\n",(0,l.jsx)(e.li,{children:"Same query returns same results within transaction"}),"\n",(0,l.jsx)(e.li,{children:"Prevents non-repeatable reads"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"Serializable"})," (strongest):"]}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BeginTx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ctx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.TxOptions{"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    Isolation: sql.LevelSerializable,"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"})"})})]})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Full isolation"}),"\n",(0,l.jsx)(e.li,{children:"Transactions execute as if serial (one at a time)"}),"\n",(0,l.jsx)(e.li,{children:"Prevents phantom reads"}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Slowest"})," - use sparingly"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"read-only-transactions",children:"Read-Only Transactions"}),"\n",(0,l.jsx)(e.p,{children:"Optimize for read-only workloads:"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BeginTx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(context."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Background"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(), "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.TxOptions{"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ReadOnly: "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"true"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"})"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Only SELECT operations"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"users, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg.SelectGeneric[User](tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SELECT * FROM users"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// INSERT/UPDATE/DELETE will fail"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// id, err := lpg.InsertGeneric(tx, &user)  // Error!"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]})]})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Benefits:"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Database can optimize (no locking needed)"}),"\n",(0,l.jsx)(e.li,{children:"Prevents accidental writes"}),"\n",(0,l.jsx)(e.li,{children:"Slightly faster for large reads"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"context-and-timeouts",children:"Context and Timeouts"}),"\n",(0,l.jsx)(e.p,{children:"Use context for timeouts and cancellation:"}),"\n",(0,l.jsx)(e.h3,{id:"with-timeout",children:"With Timeout"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"ctx, cancel "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" context."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"WithTimeout"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(context."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Background"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(), "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"5"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"time.Second)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"cancel"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BeginTx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ctx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Operations must complete within 5 seconds"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"users, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg.SelectGeneric[User](tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SELECT * FROM users"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Could be timeout error"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]})]})}),"\n",(0,l.jsx)(e.h3,{id:"with-cancellation",children:"With Cancellation"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"ctx, cancel "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" context."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"WithCancel"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(context."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Background"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"())"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Cancel from another goroutine if needed"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"go"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"stopChan"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"cancel"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Cancels transaction"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}()"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BeginTx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ctx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Operations..."})})]})}),"\n",(0,l.jsx)(e.h2,{id:"multiple-operations-in-one-transaction",children:"Multiple Operations in One Transaction"}),"\n",(0,l.jsx)(e.p,{children:"Transactions ensure atomicity across multiple operations:"}),"\n",(0,l.jsx)(e.h3,{id:"example-transfer-money",children:"Example: Transfer Money"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"TransferMoney"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(db "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.DB, fromUserID, toUserID "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"int"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", amount "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"float64"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Deduct from sender"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Update"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx,"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"UPDATE accounts SET balance = balance - $1 WHERE user_id = $2"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        amount, fromUserID)"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Automatic rollback"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Add to receiver"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Update"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx,"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"UPDATE accounts SET balance = balance + $1 WHERE user_id = $2"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        amount, toUserID)"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Automatic rollback - sender amount restored"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Both operations succeed or both fail"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsx)(e.h3,{id:"example-create-user-with-profile",children:"Example: Create User with Profile"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"CreateUserWithProfile"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(db "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.DB, user "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"User, profile "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"Profile) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Insert user"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    userID, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, user)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Insert profile with user's ID"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    profile.UserID "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" userID"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    _, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, profile)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// User insert is rolled back too"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsx)(e.h2,{id:"nested-transactions-savepoints",children:"Nested Transactions (Savepoints)"}),"\n",(0,l.jsxs)(e.p,{children:["Go's ",(0,l.jsx)(e.code,{children:"database/sql"})," doesn't support nested transactions, but you can use savepoints:"]}),"\n",(0,l.jsx)(e.h3,{id:"postgresql-savepoints",children:"PostgreSQL Savepoints"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Create savepoint"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"_, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Exec"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SAVEPOINT sp1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Some operations"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"id, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Rollback to savepoint (partial rollback)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Exec"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"ROLLBACK TO SAVEPOINT sp1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"} "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Release savepoint"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Exec"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"RELEASE SAVEPOINT sp1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Continue with other operations"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]})]})}),"\n",(0,l.jsx)(e.h3,{id:"mysql-savepoints",children:"MySQL Savepoints"}),"\n",(0,l.jsx)(e.p,{children:"Same syntax works in MySQL:"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Exec"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SAVEPOINT sp1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Operations..."})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Exec"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"ROLLBACK TO SAVEPOINT sp1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]})]})}),"\n",(0,l.jsx)(e.h2,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,l.jsx)(e.p,{children:"Transactions use connections from the pool:"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Configure pool"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"SetMaxOpenConns"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"25"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")       "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Max connections"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"SetMaxIdleConns"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"5"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Idle connections kept open"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"SetConnMaxLifetime"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"5"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" time.Minute)  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Max connection age"})]})]})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Important:"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Each transaction ",(0,l.jsx)(e.strong,{children:"holds a connection"})," until committed or rolled back"]}),"\n",(0,l.jsxs)(e.li,{children:["Long-running transactions ",(0,l.jsx)(e.strong,{children:"block other operations"})]}),"\n",(0,l.jsx)(e.li,{children:"Always commit or rollback promptly"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"pool-exhaustion",children:"Pool Exhaustion"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ❌ Bad: Holds connection indefinitely"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"time."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Sleep"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"10"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" time.Minute)  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Connection stuck!"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ✅ Good: Quick transaction"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Connection returned to pool"})]})]})}),"\n",(0,l.jsx)(e.h2,{id:"error-handling-patterns",children:"Error Handling Patterns"}),"\n",(0,l.jsx)(e.h3,{id:"basic-error-handling",children:"Basic Error Handling"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" fmt."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Errorf"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"begin tx: '}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"%w"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", err)"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"id, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" fmt."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Errorf"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"insert user: '}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"%w"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", err)"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(); err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" fmt."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Errorf"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"commit tx: '}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"%w"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", err)"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"})]})]})}),"\n",(0,l.jsx)(e.h3,{id:"with-logging",children:"With Logging"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"log"'})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    log."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Printf"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Failed to begin transaction: '}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"%v"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", err)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(); err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" sql.ErrTxDone {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        log."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Printf"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Rollback failed: '}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"%v"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", err)"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}()"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Operations..."})})]})}),"\n",(0,l.jsx)(e.h3,{id:"with-custom-errors",children:"With Custom Errors"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"var"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ErrUserExists "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" errors."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"New"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"user already exists"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ErrInvalidData "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" errors."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"New"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"invalid data"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"func"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"CreateUser"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(db "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.DB, user "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"User) "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"error"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Check if user exists"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    existing, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg.SelectGenericSingle[User](tx,"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SELECT * FROM users WHERE email = $1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", user.Email)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" existing "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ErrUserExists  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Rollback via defer"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Validate"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" user.Email "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'""'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ErrInvalidData  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Rollback via defer"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Insert"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    _, err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, user)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" err"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsx)(e.h3,{id:"1-always-use-defer-txrollback",children:"1. Always Use defer tx.Rollback()"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ✅ Always"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]})]})}),"\n",(0,l.jsx)(e.h3,{id:"2-keep-transactions-short",children:"2. Keep Transactions Short"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ❌ Bad: Long-running transaction"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" i "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"; i "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"<"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"10000"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"; i"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"++"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"records[i])  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Holds connection too long"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ✅ Good: Batch commits"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" i "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"; i "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"<"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"len"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(records); i "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"100"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" j "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" i; j "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"<"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" i"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"+"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"100"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" j "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"<"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"len"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(records); j"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"++"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"records[j])"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Release connection every 100 records"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsx)(e.h3,{id:"3-dont-perform-io-inside-transactions",children:"3. Don't Perform I/O Inside Transactions"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ❌ Bad: Network call during transaction"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg.SelectGenericSingle[User](tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SELECT * FROM users WHERE id = $1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", id)"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// HTTP call while holding transaction!"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"resp, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" http."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Get"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"https://api.example.com/validate"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Bad!"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ✅ Good: I/O outside transaction"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lpg.SelectGenericSingle[User](tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SELECT * FROM users WHERE id = $1"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", id)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Done with DB"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Now do I/O"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"resp, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" http."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Get"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"https://api.example.com/validate"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})}),"\n",(0,l.jsx)(e.h3,{id:"4-use-appropriate-isolation-levels",children:"4. Use Appropriate Isolation Levels"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// For reports (read-only, no exact consistency needed)"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BeginTx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ctx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.TxOptions{"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    Isolation: sql.LevelReadCommitted,"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ReadOnly:  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"true"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"})"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// For financial transactions (strict consistency)"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BeginTx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ctx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sql.TxOptions{"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    Isolation: sql.LevelSerializable,"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"})"})})]})}),"\n",(0,l.jsx)(e.h3,{id:"5-add-timeouts",children:"5. Add Timeouts"}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ✅ Always set a timeout"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"ctx, cancel "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" context."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"WithTimeout"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(context."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Background"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(), "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"30"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"time.Second)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"cancel"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BeginTx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(ctx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"nil"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})}),"\n",(0,l.jsx)(e.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(e.h3,{id:"sql-transaction-has-already-been-committed-or-rolled-back",children:'"sql: transaction has already been committed or rolled back"'}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"Cause:"})," Trying to use transaction after commit/rollback"]}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ❌ Bad"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx, _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" db."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Begin"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Commit"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"lpg."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"InsertGeneric"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(tx, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"user)  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Error!"})]})]})}),"\n",(0,l.jsx)(e.h3,{id:"pq-deadlock-detected",children:'"pq: deadlock detected"'}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"Cause:"})," Two transactions waiting for each other"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Solution:"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Access tables in same order"}),"\n",(0,l.jsx)(e.li,{children:"Use lower isolation levels"}),"\n",(0,l.jsx)(e.li,{children:"Keep transactions short"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"too-many-connections",children:'"too many connections"'}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"Cause:"})," Transactions not being closed"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Solution:"})}),"\n",(0,l.jsx)(e.pre,{"data-language":"go","data-theme":"default",hasCopyCode:!0,children:(0,l.jsxs)(e.code,{"data-language":"go","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ✅ Always use defer"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"defer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" tx."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Rollback"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]})]})}),"\n",(0,l.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"Pattern"}),(0,l.jsx)(e.th,{children:"Code"}),(0,l.jsx)(e.th,{children:"Use Case"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"Basic"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"defer tx.Rollback()"})}),(0,l.jsx)(e.td,{children:"All transactions"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"Read-Only"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"ReadOnly: true"})}),(0,l.jsx)(e.td,{children:"SELECT-only operations"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"Timeout"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"WithTimeout(ctx, 30*time.Second)"})}),(0,l.jsx)(e.td,{children:"Prevent hung transactions"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"Isolation"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"Isolation: LevelSerializable"})}),(0,l.jsx)(e.td,{children:"Critical consistency needs"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"Savepoint"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"SAVEPOINT sp1"})}),(0,l.jsx)(e.td,{children:"Partial rollbacks"})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"/guides/postgresql",children:"PostgreSQL Guide"})," - PostgreSQL-specific transaction features"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"/guides/mysql",children:"MySQL Guide"})," - MySQL-specific transaction features"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"/examples/basic-crud",children:"Examples"})," - See transactions in action"]}),"\n"]})]})}let h={MDXContent:function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,t.a)(),s.components);return e?(0,l.jsx)(e,{...s,children:(0,l.jsx)(c,{...s})}):c(s)},pageOpts:{filePath:"pages/guides/transactions.mdx",route:"/guides/transactions",timestamp:1766515491e3,pageMap:[{kind:"Meta",data:{index:"Home","getting-started":"Getting Started",guides:"Guides","api-reference":"API Reference",examples:"Examples",troubleshooting:"Troubleshooting",contributing:"Contributing"}},{kind:"Folder",name:"api-reference",route:"/api-reference",children:[{kind:"Meta",data:{core:"Core",postgresql:"PostgreSQL",mysql:"MySQL"}},{kind:"Folder",name:"core",route:"/api-reference/core",children:[{kind:"Meta",data:{interfaces:"Interfaces",registration:"Registration","generic-operations":"Generic Operations","manual-operations":"Manual Operations",helpers:"Helper Functions"}},{kind:"MdxPage",name:"generic-operations",route:"/api-reference/core/generic-operations"},{kind:"MdxPage",name:"helpers",route:"/api-reference/core/helpers"},{kind:"MdxPage",name:"interfaces",route:"/api-reference/core/interfaces"},{kind:"MdxPage",name:"manual-operations",route:"/api-reference/core/manual-operations"},{kind:"MdxPage",name:"registration",route:"/api-reference/core/registration"}]},{kind:"Folder",name:"mysql",route:"/api-reference/mysql",children:[{kind:"Meta",data:{overview:"Overview","crud-operations":"CRUD Operations"}},{kind:"MdxPage",name:"crud-operations",route:"/api-reference/mysql/crud-operations"},{kind:"MdxPage",name:"overview",route:"/api-reference/mysql/overview"}]},{kind:"Folder",name:"postgresql",route:"/api-reference/postgresql",children:[{kind:"Meta",data:{overview:"Overview","crud-operations":"CRUD Operations","uuid-support":"UUID Support","parameter-handling":"Parameter Handling"}},{kind:"MdxPage",name:"crud-operations",route:"/api-reference/postgresql/crud-operations"},{kind:"MdxPage",name:"overview",route:"/api-reference/postgresql/overview"},{kind:"MdxPage",name:"parameter-handling",route:"/api-reference/postgresql/parameter-handling"},{kind:"MdxPage",name:"uuid-support",route:"/api-reference/postgresql/uuid-support"}]}]},{kind:"Folder",name:"contributing",route:"/contributing",children:[{kind:"Meta",data:{development:"Development Setup",testing:"Testing"}},{kind:"MdxPage",name:"development",route:"/contributing/development"},{kind:"MdxPage",name:"testing",route:"/contributing/testing"}]},{kind:"Folder",name:"examples",route:"/examples",children:[{kind:"Meta",data:{"basic-crud":"Basic CRUD","postgresql-complete":"PostgreSQL Complete Example","mysql-complete":"MySQL Complete Example","uuid-entities":"UUID Entities","custom-naming":"Custom Naming Strategy","advanced-queries":"Advanced Queries"}},{kind:"MdxPage",name:"advanced-queries",route:"/examples/advanced-queries"},{kind:"MdxPage",name:"basic-crud",route:"/examples/basic-crud"},{kind:"MdxPage",name:"custom-naming",route:"/examples/custom-naming"},{kind:"MdxPage",name:"mysql-complete",route:"/examples/mysql-complete"},{kind:"MdxPage",name:"postgresql-complete",route:"/examples/postgresql-complete"},{kind:"MdxPage",name:"uuid-entities",route:"/examples/uuid-entities"}]},{kind:"Folder",name:"getting-started",route:"/getting-started",children:[{kind:"Meta",data:{introduction:"Introduction",installation:"Installation","quick-start":"Quick Start","core-concepts":"Core Concepts"}},{kind:"MdxPage",name:"core-concepts",route:"/getting-started/core-concepts"},{kind:"MdxPage",name:"installation",route:"/getting-started/installation"},{kind:"MdxPage",name:"introduction",route:"/getting-started/introduction"},{kind:"MdxPage",name:"quick-start",route:"/getting-started/quick-start"}]},{kind:"Folder",name:"guides",route:"/guides",children:[{kind:"Meta",data:{postgresql:"PostgreSQL",mysql:"MySQL",registration:"Registration System","naming-strategies":"Naming Strategies",transactions:"Transactions"}},{kind:"MdxPage",name:"mysql",route:"/guides/mysql"},{kind:"MdxPage",name:"naming-strategies",route:"/guides/naming-strategies"},{kind:"MdxPage",name:"postgresql",route:"/guides/postgresql"},{kind:"MdxPage",name:"registration",route:"/guides/registration"},{kind:"MdxPage",name:"transactions",route:"/guides/transactions"}]},{kind:"MdxPage",name:"index",route:"/"},{kind:"Folder",name:"troubleshooting",route:"/troubleshooting",children:[{kind:"Meta",data:{"common-errors":"Common Errors",debugging:"Debugging Guide","migration-guide":"Migration Guide"}},{kind:"MdxPage",name:"common-errors",route:"/troubleshooting/common-errors"},{kind:"MdxPage",name:"debugging",route:"/troubleshooting/debugging"},{kind:"MdxPage",name:"migration-guide",route:"/troubleshooting/migration-guide"}]}],flexsearch:{codeblocks:!0},title:"Transactions",headings:a},pageNextRoute:"/guides/transactions",nextraLayout:o.ZP,themeConfig:i.Z};e.default=(0,r.j)(h)},9004:function(s,e,n){"use strict";var l=n(5893);e.Z={logo:(0,l.jsx)("span",{style:{fontWeight:700,fontSize:"1.2rem"},children:"⚡ go-lightning"}),project:{link:"https://github.com/tracewayapp/go-lightning"},docsRepositoryBase:"https://github.com/tracewayapp/go-lightning/tree/main/docs",useNextSeoProps:()=>({titleTemplate:"%s – go-lightning"}),head:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,l.jsx)("meta",{property:"og:title",content:"go-lightning"}),(0,l.jsx)("meta",{property:"og:description",content:"Lightweight Go library for simplified database operations"})]}),primaryHue:205,darkMode:!0,nextThemes:{defaultTheme:"dark"},sidebar:{defaultMenuCollapseLevel:1,toggleButton:!0},toc:{backToTop:!0},editLink:{text:"Edit this page on GitHub →"},feedback:{content:"Question? Give us feedback →",labels:"feedback"},footer:{text:(0,l.jsxs)("span",{children:["MIT ",new Date().getFullYear()," \xa9"," ",(0,l.jsx)("a",{href:"https://github.com/tracewayapp",target:"_blank",children:"Traceway"})]})}}},5789:function(){}},function(s){s.O(0,[73,888,774,179],function(){return s(s.s=4392)}),_N_E=s.O()}]);